<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>Gungnir Model</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Gungnir</span> <span class="project-version">0.0.1-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="README.html"><div class="inner"><span>Gungnir</span></div></a></li><li class="depth-1  current"><a href="model.html"><div class="inner"><span>Gungnir Model</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>gungnir</span></div></div></li><li class="depth-2 branch"><a href="gungnir.changeset.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>changeset</span></div></a></li><li class="depth-2"><a href="gungnir.database.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>database</span></div></a></li><li class="depth-3 branch"><a href="gungnir.database.builder.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>builder</span></div></a></li><li class="depth-3"><a href="gungnir.database.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2 branch"><a href="gungnir.decode.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>decode</span></div></a></li><li class="depth-2 branch"><a href="gungnir.field.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>field</span></div></a></li><li class="depth-2 branch"><a href="gungnir.model.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>model</span></div></a></li><li class="depth-2 branch"><a href="gungnir.query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>query</span></div></a></li><li class="depth-2 branch"><a href="gungnir.record.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>record</span></div></a></li><li class="depth-2 branch"><a href="gungnir.spec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>spec</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></div></li><li class="depth-3"><a href="gungnir.util.malli.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>malli</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#gungnir-model" name="gungnir-model"></a>Gungnir Model</h1>
<h2><a href="#malli-schemas" name="malli-schemas"></a>Malli Schemas</h2>
<h2><a href="#model-field-properties" name="model-field-properties"></a>Model Field Properties</h2>
<h3><a href="#required-" name="required-"></a><code>:primary-key</code> (required)</h3>
<p>Describe which key is the <code>PRIMARY KEY</code> in your database. This is required for Gungnir to be able to make use of the full querying API, as well as the relational mapping.</p>
<pre><code class="clojure">[:user/id {:primary-key true} uuid?]
</code></pre>
<h3><code>:auto</code></h3>
<p>Tell Gungnir that this key is automatically managed by the database, and Gungir should never make an attempt to modify it. This is useful for e.g. <code>TIMESTAMP</code> columns which might update automatically.</p>
<pre><code class="sql">created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL
</code></pre>
<pre><code class="clojure">[:user/created-at {:auto true} inst?]
</code></pre>
<h3><code>:virtual</code></h3>
<p>Tell Gungnir that you want this key to be part of your Model, but it does not exist as a field in the database. Gungnir will make no attempt to query, or save this key. Useful for things such as password-confirmation fields.</p>
<pre><code class="clojure">[:user/password-confirmation {:virtual true} string?]
</code></pre>
<h3><code>:before-save</code></h3>
<p>Add hooks to a column to be executed before you save to the database. This is useful to keep data transformations consistent. For example you always want to encrypt passwords before saving them to the database. Passwords could be set during creating, updated on the profile page, changed through a password reset. In all of these cases you must encrypt the user’s inputted password before inserting to the database.</p>
<p>Add a <code>:bcrypt</code> key to the <code>:before-save</code> vector for <code>:user/password</code>.</p>
<pre><code class="clojure">[:user/password {:before-save [:bcrypt} string?]
</code></pre>
<p>And define the <code>:bycrypt</code> <code>:before-save</code> handler. Handlers take the key and value of field in question. The resulting value of <code>gungnir.model/before-save</code> will be saved in the database.</p>
<pre><code class="clojure">(defmethod gungnir.model/before-save :bcrypt [_k v]
  (hashers/derive v))
</code></pre>
<h3><code>:before-read</code></h3>
<p>Add hooks to a column to be executed before you read it from database. This is useful if want to sanitize any query paramaters before reading. For example you could save all emails as lowercase (with the <code>gungnir.model/before-save</code> hook). Then add a <code>:before-read</code> hook to lowercase the email field when you query the database. That way you’ll be able to deal case sensitive data.</p>
<p>Add the <code>:before-save</code> and <code>:before-read</code> hooks.</p>
<pre><code class="clojure">[:user/email 
 {:before-save [:string/lower-case]
  :before-read [:string/lower-case]}
 [:re #".+@.+\..+"]]
</code></pre>
<p>Define the hooks to be used</p>
<pre><code class="clojure">(defmethod gungnir.model/before-save :string/lower-case [_k v]
  (clojure.string/lower-case v))

(defmethod gungnir.model/before-read :string/lower-case [_k v]
  (clojure.string/lower-case v))
</code></pre>
<p>Gungnir has the <code>:string/lower-case</code> hooks built-in, so you don’t have to define it yourself.</p>
<h3><code>:after-read</code></h3>
<p>Add hooks to a column to be executed after you read it from database. This is useful if want to transform any data after you read it from the database. You could encrypt data before saving it, and decrypt it after reading it for extra security. Another use case is saving keywords to the database as strings, and parsing it as EDN after reading it.</p>
<p>In this case, user has an <code>:user/option</code> key, which is a qualified-keyword. You can’t store keywords in SQL, so it’s converted to a string.</p>
<pre><code class="clojure">[:user/option 
 {:after-read [:edn/read-string]}
 [:enum :option/one :option/two :option/three]]
</code></pre>
<p>Define the <code>:edn/read-string</code> hook to convert the keywords. <code>:edn/read-string</code> is also built-in Gungnir, so you don’t have to defined it yourself.</p>
<pre><code class="clojure">(defmethod after-read :edn/read-string [_ v]
  (if (vector? v)
    (mapv edn/read-string v)
    (edn/read-string v)))
</code></pre>
<h2><a href="#model-relation-definitions" name="model-relation-definitions"></a>Model Relation Definitions</h2></div></div></div></body></html>